/**
 * @eleven.fe/ball-collision v1.1.0
 * Author: Eleven
 * npmjs.com: https://www.npmjs.com/package/@eleven.fe/ball-collision
 * Date: Fri Jul 31 2020 01:30:05 GMT+0800 (中国标准时间)
 */

!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).BallCollision=i()}(this,(function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var s in i=arguments[e])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},i=function(){function t(t){var i=t.ctx,e=t.img,n=t.imgSrc,s=t.bgColor,o=t.x,r=t.y,a=t.r,h=t.velX,c=t.velY,l=t.speedMin,d=t.speedMax;this.ctx=i,this.img=e,this.imgSrc=n,this.bgColor=s,this.x=o,this.y=r,this.r=a,this.velX=h,this.velY=c,this.speedMin=l,this.speedMax=d,this.isLoading=!1}return t.prototype.draw=function(){var t=this;if(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.r,0,2*Math.PI),this.bgColor&&"string"==typeof this.bgColor&&(this.ctx.fillStyle=this.bgColor,this.ctx.fill()),this.ctx.clip(),!this.img&&this.imgSrc&&"string"==typeof this.imgSrc){var i=new Image;/^data:/.test(this.imgSrc)?(i.src=this.imgSrc,this.img=i):this.isLoading||(this.isLoading=!0,i.onload=function(){t.img=i,t.isLoading=!1},i.src=this.imgSrc)}this.img&&this.img instanceof Image&&this.ctx.drawImage(this.img,this.x-this.r,this.y-this.r,2*this.r,2*this.r),this.ctx.restore()},t.prototype.detect=function(t){var i=this;return t.map((function(t){if(i!==t){var e=i.x+i.velX-(t.x+t.velX),n=i.y+i.velY-(t.y+t.velY);if(Math.sqrt(e*e+n*n)<=i.r+t.r){var s=i.velX-t.velX,o=i.velY-t.velY,r=i.x-t.x,a=i.y-t.y,h=r*r+a*a,c=(s*r*r+o*r*a)/h,l=(o*a*a+s*r*a)/h;i.velX=i._checkSpeed(i.velX-c),i.velY=i._checkSpeed(i.velY-l),t.velX=i._checkSpeed(t.velX+c),t.velY=i._checkSpeed(t.velY+l)}}return t}))},t.prototype.update=function(){var t=this.ctx.canvas.getBoundingClientRect();this.x+this.r>=t.width&&(this.velX=-this.velX),this.x-this.r<=0&&(this.velX=-this.velX),this.y+this.r>=t.height&&(this.velY=-this.velY),this.y-this.r<=0&&(this.velY=-this.velY),this.x+=this.velX,this.y+=this.velY},t.prototype._checkSpeed=function(t){return t>this.speedMax?t=this.speedMax:t<this.speedMin&&(t=this.speedMin),t},t}(),e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,r=/^0o[0-7]+$/i,a=parseInt,h="object"==typeof e&&e&&e.Object===Object&&e,c="object"==typeof self&&self&&self.Object===Object&&self,l=h||c||Function("return this")(),d=Object.prototype.toString,u=Math.max,f=Math.min,v=function(){return l.Date.now()};function p(t){var i=typeof t;return!!t&&("object"==i||"function"==i)}function g(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==d.call(t)}(t))return NaN;if(p(t)){var i="function"==typeof t.valueOf?t.valueOf():t;t=p(i)?i+"":i}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(n,"");var e=o.test(t);return e||r.test(t)?a(t.slice(2),e?2:8):s.test(t)?NaN:+t}var x=function(t,i,e){var n,s,o,r,a,h,c=0,l=!1,d=!1,x=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function m(i){var e=n,o=s;return n=s=void 0,c=i,r=t.apply(o,e)}function y(t){return c=t,a=setTimeout(w,i),l?m(t):r}function b(t){var e=t-h;return void 0===h||e>=i||e<0||d&&t-c>=o}function w(){var t=v();if(b(t))return M(t);a=setTimeout(w,function(t){var e=i-(t-h);return d?f(e,o-(t-c)):e}(t))}function M(t){return a=void 0,x&&n?m(t):(n=s=void 0,r)}function C(){var t=v(),e=b(t);if(n=arguments,s=this,h=t,e){if(void 0===a)return y(h);if(d)return a=setTimeout(w,i),m(h)}return void 0===a&&(a=setTimeout(w,i)),r}return i=g(i)||0,p(e)&&(l=!!e.leading,o=(d="maxWait"in e)?u(g(e.maxWait)||0,i):o,x="trailing"in e?!!e.trailing:x),C.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=h=s=a=void 0},C.flush=function(){return void 0===a?r:M(v())},C},m=window.navigator.userAgent,y=/(ipad|iphone|ipod)/i.test(m),b=/android/i.test(m),w=/windows phone/i.test(m),M=y||b||w;function C(t,i){return Math.floor(Math.random()*(i-t)*100)/100+t}function S(){return"rgb("+C(0,255)+", "+C(0,255)+", "+C(0,255)+")"}var _="orientationchange"in window?"orientationchange":"resize";return function(){function e(t){var i=this,e=t.canvas,n=t.balls,s=void 0===n?[]:n,o=t.speedMin,r=void 0===o?-2:o,a=t.speedMax,h=void 0===a?2:a,c=t.bgColor,l=void 0===c?"transparent":c,d=t.docEl,u=void 0===d?document.documentElement:d,f=t.designWidth,v=void 0===f?375:f,p=t.scaleInPC,g=void 0===p||p;if(this.balls=[],this._run=function(){if(!i.ctx)throw new Error("not valid ctx");i.ctx.clearRect(0,0,i.rectCanvas.width,i.rectCanvas.height),i.ctx.fillStyle=i.bgColor,i.ctx.fillRect(0,0,i.rectCanvas.width,i.rectCanvas.height),i.balls.map((function(t){t.draw(),i.balls=t.detect(i.balls),t.update()})),i.raf=window.requestAnimationFrame(i._run)},this._onResize=x((function(){i.destroy(),i._init()}),150,{maxWait:1e3}),!e)throw new Error("not valid canvas element");this.canvas=e,this.speedMin=r,this.speedMax=h,this.bgColor="random"===l?S():l,this.ballsSetting=s,this.docEl=u,this.designWidth=v,this.scaleInPC=g,this._init()}return e.prototype._init=function(){this.rectCanvas=this.canvas.getBoundingClientRect(),this._create(),this._run(),this._bindEvents()},e.prototype._create=function(){var e=this,n=this.docEl.clientWidth,s=this.scaleInPC||M?n/this.designWidth:1,o=this.ballsSetting.map((function(i){return t(t({},i),{r:i.r*s,x:i.x*s,y:i.y*s})}));this.ctx=function(t){if(!t)throw new Error("not valid canvas element");var i=t.getContext("2d"),e=window.devicePixelRatio||1,n=t.getBoundingClientRect();return t.width=n.width*e,t.height=n.height*e,i&&i.scale(e,e),i}(this.canvas),this.balls=o.map((function(t){var n=t.x,s=t.y,o=t.r,r=t.velX,a=t.velY,h=t.img,c=t.imgSrc,l=t.bgColor,d=t.speedMin,u=t.speedMax;return new i({ctx:e.ctx,x:n,y:s,r:o,img:h,imgSrc:c,bgColor:"random"===l?S():l,velX:r||C(d||e.speedMin,u||e.speedMax),velY:a||C(d||e.speedMin,u||e.speedMax),speedMin:d||e.speedMin,speedMax:u||e.speedMax})}))},e.prototype._bindEvents=function(){window.addEventListener(_,this._onResize,!1)},e.prototype.destroy=function(){var t=this.canvas.getBoundingClientRect();window.removeEventListener(_,this._onResize,!1),window.cancelAnimationFrame(this.raf),this.ctx.clearRect(0,0,t.width,t.height)},e}()}));
//# sourceMappingURL=ball-collision.umd.js.map
